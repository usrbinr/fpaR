---
title: "ABC Segmentation"
subtitle: "How to use segmentation strategies to simplify your analysis "


vignette: >
  %\VignetteIndexEntry{ABC Segmentation}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| echo: false
quarto::write_yaml_metadata_block(
   date=format(Sys.Date())
   )
```


### Introduction

In business and financial analytics, the **ABC classification** method is widely used to categorize items, customers, or other groups according to their contribution to a total metric.  

The `abc()` function provides a flexible and robust way to perform ABC segmentation, either based on **transaction counts** or the sum of a **numeric variable** such as sales margin or revenue.

### Function Purpose

`abc()`:

- Segments a dataset into categories (A, B, C, etc.) based on cumulative contribution.
- Allows for **custom break points** (e.g., top 10% = A, next 40% = B, etc.).
- Works on both **grouped tibbles** and **database-backed objects**.
- Returns a **segment object**, which is processed by `calculate()` to produce a table of results.

### How It Works

> `fpaR::abc()` requires a grouped tibble or lazy DBI object using `dplyr::group_by()` to specific the groups that drive the contribution

**Value Capture**  

-  If `.value` is provided, the function sums it per group; otherwise, it counts rows.

**Segment Object Creation**  

-  The function creates a `segment` object which stores all the necessary metadata for later computation.
**Category Values**

-  @tbl-abc-args explains the break points should be cumulative so if you want to see the stores that make up the top 40% of revenue follow by top 70% and then 90% you should put in `c(0.4,.7,.9,1)`


```{r}
#| label: tbl-abc-args
#| echo: false
#| eval: true

tibble::tibble(
  Argument = c(".data", "category_values", ".value"),
  Description = c(
    "A grouped tibble or DBI object (using dplyr::group_by())",
    "A numeric vector of breakpoints between 0 and 1, representing cumulative proportions for ABC categories.",
    "Optional. A column to sum for categorization. If not provided, the function counts the number of rows per group."
  )
) |> tinytable::tt()

```



### Output

The function returns a **segment object**. Use `calculate()` to generate the ABC classification table:


If we wanted to 

```{r}
#| label: abc-example
#| echo: true
#| eval: true

# Example

contoso::sales |> 
   dplyr::group_by(store_key) |> 
   fpaR::abc(
      category_values = c(0.4,.7,.9,1), 
      .value = margin
      )
```
   
To return the results, use `fpaR::calculate()` 

```{r}
#| label: var
#| echo: true
#| eval: false
#| warning: false
#| message: false
#| include: true
contoso::sales |> 
   dplyr::group_by(store_key) |> 
   fpaR::abc(
      category_values = c(0.4,.7,.9,1), 
      .value = margin
      ) |> 
   fpaR::calculate()
```

```{r}
#| label: tbl-output-no-echo
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| include: true
contoso::sales |> 
   dplyr::group_by(store_key) |> 
   fpaR::abc(
      category_values = c( 0.4,.7,.9,1), 
      .value = margin
      ) |> 
   fpaR::calculate() |> 
   dplyr::collect() |> 
   dplyr::arrange(category_name) |> 
   head(10) |> 
   tinytable::tt()
```
